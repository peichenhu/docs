(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2a1ce23e"],{"2d85":function(t,a,e){},"2f21":function(t,a,e){"use strict";var i=e("79e5");t.exports=function(t,a){return!!t&&i((function(){a?t.call(null,(function(){}),1):t.call(null)}))}},3939:function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"attackTracking"},[e("TOP",{attrs:{title:"攻击来源回溯"}}),e("div",{staticClass:"right box_num"},[e("el-date-picker",{attrs:{clearable:!1,type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":t.pickerOptions,"popper-class":"myDatepicker"},on:{change:t.onDataChange},model:{value:t.dataPickerVal,callback:function(a){t.dataPickerVal=a},expression:"dataPickerVal"}})],1),e("div",{staticClass:"left box_num"},[e("div",{staticClass:"title"},[t._v("IP: "+t._s(t.ip))])]),e("div",{staticClass:"box_attack_info"},[t._m(0),e("div",{staticClass:"col details"},[e("p",{staticClass:"count"},[e("span",[t._v("攻击次数：")]),e("count-to",{staticClass:"number count_to",attrs:{innerSpan:!0,"start-val":0,"end-val":t.attackCount,separator:""}})],1),e("p",[e("span",[t._v("IP来源：")]),t._v(" "+t._s(t.ip_address))]),e("p",[e("span",[t._v("地理坐标：")]),t._v("\n        "+t._s(t.ip_geo)+"\n        "),"NaN/NaN"!==t.ip_geo?e("i",{staticClass:"el-icon-circle-plus",staticStyle:{color:"#4d8cff","font-size":"18px",cursor:"pointer"},on:{click:function(a){t.dialogGeo=!t.dialogGeo}}}):t._e()]),e("p",[e("span",[t._v("影响范围：")]),t._v(" "+t._s(t.ip_city)+"个城市 "+t._s(t.ip_app)+"个应用")])]),e("div",{staticClass:"col whois"},[e("a",{attrs:{href:"http://ipwhois.cnnic.net.cn/bns/query/Query/ipwhoisQuery.do?txtquery="+t.ip+"&queryOption=ipv4",target:"_blank"}},[t._v("更多信息请进行IP Whois查询 >")])])]),e("div",{staticClass:"box_pie"},[e("boxBg"),e("span",{staticClass:"title"},[t._v("攻击方式占比")]),e("v-chart",{ref:"pie",staticClass:"chart",attrs:{options:t.chartPieOpts}})],1),e("div",{staticClass:"box_wordCloud city"},[e("boxBg"),e("span",{staticClass:"title"},[t._v("城市威胁标签")]),e("v-chart",{ref:"wordCloudCity",staticClass:"chart",attrs:{options:t.chartWordCloudCityOpts}})],1),e("div",{staticClass:"box_wordCloud website"},[e("boxBg"),e("span",{staticClass:"title"},[t._v("站点威胁标签")]),e("v-chart",{ref:"wordCloudWebsite",staticClass:"chart",attrs:{options:t.chartWordCloudWebsiteOpts}})],1),e("div",{staticClass:"box_timeline"},[e("span",{staticClass:"title"},[t._v("\n      攻击路径\n    ")]),t._m(1),e("div",{staticClass:"timeline"},[e("div",{staticClass:"start"},[t._v("现在")]),e("div",{ref:"listScroll",staticClass:"list"},t._l(t.attackList,(function(a,i){return e("div",{key:i,staticClass:"item",on:{click:function(a){return t.showDetails(i)}}},[e("div",{staticClass:"time",class:a.level},[t._v(t._s(a.time))]),e("div",{staticClass:"name"},[t._v(t._s(a.app))]),e("div",{staticClass:"tag"},[e("span",{class:a.level},[t._v(t._s(a.type))])])])})),0),t.isOnBottom?e("div",{staticClass:"end"},[e("p",[e("span",[e("i",{class:t.pageLoading?"el-icon-loading":"el-icon-more"})]),t.pageLoading?t._e():e("span",{staticClass:"btn",on:{click:t.loadMore}},[t._v("\n            查看更多")])])]):t._e()])]),e("el-dialog",{staticClass:"myDialog",attrs:{visible:t.dialogGeo,width:"1040px","modal-append-to-body":!1},on:{"update:visible":function(a){t.dialogGeo=a}}},[e("span",{attrs:{slot:"title"},slot:"title"},[t._v("地理坐标")]),e("v-chart",{ref:"map",staticStyle:{width:"1000px",height:"500px"},attrs:{options:t.mapOpts}})],1),e("el-dialog",{staticClass:"myDialog",attrs:{visible:t.dialogShow,width:"50%","modal-append-to-body":!1},on:{"update:visible":function(a){t.dialogShow=a}}},[e("span",{attrs:{slot:"title"},slot:"title"},[t._v("详情")]),t.dialogData?e("div",{staticClass:"list"},[e("div",{staticClass:"item",staticStyle:{width:"50%"}},[t._v("\n        应用名称："+t._s(t.dialogData.site_name||"无")+"\n      ")]),e("div",{staticClass:"item",staticStyle:{width:"50%"}},[t._v("\n        攻击时间："+t._s(t.fmtDate("Y-M-D hh:mm:ss",t.dialogData.attack_time))+"\n      ")]),e("div",{staticClass:"item",staticStyle:{width:"50%"}},[t._v("\n        攻击类型："+t._s(t.dialogData.attack_type||"无")+"\n      ")]),e("div",{staticClass:"item",staticStyle:{width:"50%"}},[t._v("\n        请求方法："+t._s(t.dialogData.request_method||"无")+"\n      ")]),e("div",{staticClass:"item"},[t._v("请求地址："+t._s(t.dialogData.request_uri||"无"))]),e("div",{staticClass:"item"},[t._v("COOKIE："+t._s(t.dialogData.cookie||"无"))])]):t._e(),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[0!==t.dialogDataIndex?e("span",{staticClass:"btn",on:{click:function(a){return t.changeDialog(-1)}}},[t._v("上一页")]):t._e(),t.dialogDataIndex<t.attackList.length-1?e("span",{staticClass:"btn",on:{click:function(a){return t.changeDialog(1)}}},[t._v("\n        下一页\n      ")]):t._e()])])],1)},s=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"col title"},[e("span",[t._v("攻击源概述")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"floatRight"},[e("i",{staticClass:"dot lg"}),t._v("高危应用 "),e("i",{staticClass:"dot md"}),t._v("中危应用\n      "),e("i",{staticClass:"dot sm"}),t._v("低危应用\n    ")])}],n=(e("7f7f"),e("55dd"),e("96cf"),e("3b8d")),o=(e("a481"),e("28a5"),e("4e7a")),r={name:"地理坐标",type:"effectScatter",coordinateSystem:"geo",zlevel:2,rippleEffect:{brushType:"stroke"},itemStyle:{normal:{color:"white"}},data:[{name:"",value:[]}]},l={map:"world",label:{emphasis:{show:!1}},itemStyle:{normal:{areaColor:"#2e539d",borderColor:"#1b236f"},emphasis:{areaColor:"#2e539d"}},regions:[{name:"China",selected:!0,itemStyle:{emphasis:{areaColor:"#4882EE"}},label:{emphasis:{show:!1}}}]},c={backgroundColor:"#1b236f",tooltip:{trigger:"item",formatter:"{a} :<br/>{b0}<br/> {c0}"},geo:l,series:[]},d=e("c4cb"),p={series:[{name:"热点分析",type:"wordCloud",shape:"circle",left:"center",top:"center",width:"70%",height:"80%",right:null,bottom:null,sizeRange:[14,48],rotationRange:[-90,90],rotationStep:45,gridSize:14,drawOutOfBound:!1,textStyle:{emphasis:{shadowBlur:1,shadowColor:"#333"}},data:[]}]},h=e("8588"),u=e("fa7d"),g=e("4ec3"),m=e("a905"),v=function(){var t=this,a=t.$createElement;t._self._c;return t._m(0)},f=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"box"},[e("div",{staticClass:"_top"},[e("div",{staticClass:"top_border"}),e("div",{staticClass:"top_trapezoid"}),e("div",{staticClass:"top_left_trapezoid"}),e("div",{staticClass:"top_left_triangle"})]),e("div",{staticClass:"_md"}),e("div",{staticClass:"_bt"},[e("div",{staticClass:"bt_right"}),e("div",{staticClass:"bt_center"}),e("div",{staticClass:"bt_left"})])])}],_=(e("a7d9"),e("2877")),C={},b=Object(_["a"])(C,v,f,!1,null,"5abccd69",null),y=b.exports,k={name:"attackTracking",components:{TOP:m["a"],boxBg:y},data:function(){return{dialogGeo:!1,mapOpts:c,dialogShow:!1,dialogDataIndex:-1,dialogData:null,dataPickerVal:[new Date(+new Date-2592e6),new Date],pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(t){var a=new Date,e=new Date;e.setTime(e.getTime()-6048e5),t.$emit("pick",[e,a])}},{text:"最近一个月",onClick:function(t){var a=new Date,e=new Date;e.setTime(e.getTime()-2592e6),t.$emit("pick",[e,a])}},{text:"最近三个月",onClick:function(t){var a=new Date,e=new Date;e.setTime(e.getTime()-7776e6),t.$emit("pick",[e,a])}}]},pageLoading:!1,pageIndex:1,pageSize:30,attackList:[],isOnBottom:!1,isMoreAttack:!0,attackCount:0,ip_address:"未知",ip_geo:"NaN/NaN",ip_city:0,ip_app:0,timerPie:null,chartPieOpts:o["a"],chartWordCloudCityOpts:o["a"],chartWordCloudWebsiteOpts:o["a"],id:this.$route.query.id,ip:this.$route.query.ip,highAttack:1234,chart:null}},computed:{startTime:function(){return Object(u["a"])("Y-M-D",this.dataPickerVal[0])+" 00:00:00"},endTime:function(){return Object(u["a"])("Y-M-D",this.dataPickerVal[1])+" 23:59:59"},highAttackArray:function(){return Object(u["b"])(this.highAttack,99999999).split("")}},created:function(){this.$route.query.ip?(this.refreshAPI(),this.loadPage()):this.$router.replace({name:"securityMonitor"})},mounted:function(){var t=this;this.$nextTick((function(){t.$refs.listScroll.addEventListener("scroll",t.onListScroll)}))},methods:{fmtDate:u["a"],onDataChange:function(){this.refreshAPI()},changeDialog:function(t){this.dialogDataIndex+=t,this.dialogData=this.attackList[this.dialogDataIndex].origin},showDetails:function(t){this.dialogDataIndex=t,this.dialogData=this.attackList[t].origin,this.dialogShow=!0},loadMore:function(){this.pageIndex++,this.loadPage()},onListScroll:function(t){this.isMoreAttack&&t.target.scrollHeight-30<t.target.scrollTop+t.target.offsetHeight?this.isOnBottom=!0:this.isOnBottom=!1},loadPage:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var a,e,i,s,n,o,l,p,h;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.pageLoading=!0,t.prev=1,t.next=4,Object(g["c"])(g["a"].getAttackInfo,{remoteip:this.ip,startTime:this.startTime,endTime:this.endTime,pageIndex:this.pageIndex,pageSize:this.pageSize});case 4:a=t.sent,a.data&&a.data.length>0&&(e=a.data[0],this.ip_address="".concat(e.location.country_cn_name||"未知国家"," \n          ").concat(e.location.region_name||"未知区域"," \n          ").concat(e.location.city||"未知城市"),this.ip_geo="NaN/NaN",i=d[e.location.city],s=d[e.location.city.slice(0,e.location.city.length-1)],n=d[e.location.region_name],o=d[e.location.region_name.slice(0,e.location.region_name.length-1)],l=d[e.location.country_cn_name],p=d[e.location.country_cn_name.slice(0,e.location.country_cn_name.length-1)],i?this.ip_geo=i.join("/"):s?this.ip_geo=s.join("/"):n?this.ip_geo=n.join("/"):o?this.ip_geo=o.join("/"):l?this.ip_geo=l.join("/"):p&&(this.ip_geo=p.join("/")),"NaN/NaN"!==this.ip_geo&&(h=JSON.parse(JSON.stringify(c)),r.data[0].name=this.ip_address,r.data[0].value=this.ip_geo.split("/"),h.series[0]=r,this.mapOpts=h),this.updateTimeline(a.data)),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1),console.log(t.t0);case 11:this.pageLoading=!1;case 12:case"end":return t.stop()}}),t,this,[[1,8]])})));function a(){return t.apply(this,arguments)}return a}(),refreshAPI:function(){var t=this;Object(g["d"])(g["a"].getAttackTypeAndLevel,{remoteip:this.ip,startTime:this.startTime,endTime:this.endTime}).then((function(a){t.updatePie(a)})),Object(g["d"])(g["a"].getThreatLabel,{remoteip:this.ip,startTime:this.startTime,endTime:this.endTime}).then((function(a){t.initWordCloudCity(a.cityThreatLabel),t.initWordCloudWebsite(a.siteThreatLabel)}))},updateTimeline:function(t){this.isOnBottom=0===t.length,this.isMoreAttack=t.length>=this.pageSize,this.attackList=this.attackList.concat(t.map((function(t){return{origin:t,level:t.attack_level||"low",time:Object(u["a"])("Y-M-D hh:mm:ss",t.attack_time),app:t.site_name,type:t.attack_type}})))},updatePie:function(t){if("{}"===JSON.stringify(t.attackLevel))return this.chartPieOpts=o["a"];var a=JSON.parse(JSON.stringify(h["a"])),e=t.attackLevel.high||0,i=t.attackLevel.medium||0,s=t.attackLevel.low||0;a.series[0].data[0].value=e,a.series[0].data[1].value=i,a.series[0].data[2].value=s,a.series[1].data=Object(h["b"])(t.attackType),this.attackCount=e+i+s,this.chartPieOpts=a,null===this.timerPie&&this.$nextTick(this.animationPie)},animationPie:function(){var t=-1,a=this.$refs.pie,e=a.options.series[1].data.length,i=function(){a.dispatchAction({type:"downplay",seriesIndex:1,dataIndex:t}),t=(t+1)%e,a.dispatchAction({type:"highlight",seriesIndex:1,dataIndex:t}),a.dispatchAction({type:"showTip",seriesIndex:1,dataIndex:t})};i(),this.timerPie=setInterval(i,5e3)},fmtData:function(t){var a=["#4F93FF","#0DC1FF","#60E9EA","#28C771","#FEC42C","#DD4444","#DD4D79","#8622F7"];return t.map((function(t,e){return{name:t,value:Math.round(255*Math.random()),textStyle:{normal:{color:a[e%a.length]}}}}))},initWordCloudCity:function(t){if("{}"===JSON.stringify(t))return this.chartWordCloudCityOpts=o["a"];var a=JSON.parse(JSON.stringify(p)),e=[];for(var i in t)e.push({name:i,value:t[i]});e.sort((function(t,a){return a.value-t.value})),e=e.map((function(t){return t.name})),this.ip_city=e.length,a.series[0].name="城市威胁标签",a.series[0].data=this.fmtData(e),this.chartWordCloudCityOpts=a},initWordCloudWebsite:function(t){if("{}"===JSON.stringify(t))return this.chartWordCloudWebsiteOpts=o["a"];var a=JSON.parse(JSON.stringify(p)),e=[];for(var i in t)e.push({name:i,value:t[i]});e.sort((function(t,a){return a.value-t.value})),e=e.map((function(t){return t.name})),this.ip_app=e.length,a.series[0].name="站点威胁标签",a.series[0].data=this.fmtData(e),this.chartWordCloudWebsiteOpts=a}}},w=k,O=(e("cb2d"),Object(_["a"])(w,i,s,!1,null,"63607654",null));a["default"]=O.exports},"55dd":function(t,a,e){"use strict";var i=e("5ca1"),s=e("d8e8"),n=e("4bf8"),o=e("79e5"),r=[].sort,l=[1,2,3];i(i.P+i.F*(o((function(){l.sort(void 0)}))||!o((function(){l.sort(null)}))||!e("2f21")(r)),"Array",{sort:function(t){return void 0===t?r.call(n(this)):r.call(n(this),s(t))}})},"75ac":function(t,a,e){},8588:function(t,a,e){"use strict";e.d(a,"b",(function(){return s}));e("a481"),e("456d"),e("ac6a");var i=[" rgba(127, 36, 239, 1)"," rgba(179, 85, 233, 1)"," rgba(211, 77, 121, 1)"," rgba(194, 67, 77,  1)"," rgba(247, 153, 55, 1)"," rgba(251, 193, 46, 1)"," rgba(212, 223, 90, 1)"," rgba(40, 190, 115, 1)"," rgba(120, 195, 197,1)"," rgba(3, 174, 235,  1)"," rgba(81, 139, 233, 1)"],s=function(t){var a=[];return Object.keys(t).forEach((function(e,s){var n={name:e,value:t[e]},o=i[s%11],r=o.replace("1)","0.2)");n.itemStyle={normal:{color:r,borderColor:o},emphasis:{color:o}},n.labelLine={lineStyle:{color:o}},n.label={formatter:"{b}",color:"#fff"},a.push(n)})),a};a["a"]={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},color:i,series:[{name:"攻击方式占比",type:"pie",selectedMode:"single",minAngle:10,radius:["0","35%"],label:{normal:{position:"inner"}},labelLine:{normal:{show:!1}},data:[{value:0,name:"高危攻击",itemStyle:{color:"#0A2AEF"}},{value:0,name:"中危攻击",itemStyle:{color:"#2A6AFF"}},{value:0,name:"低危攻击",itemStyle:{color:"#4D8CFF"}}]},{name:"攻击方式占比",type:"pie",minAngle:10,radius:["45%","55%"],data:[]}]}},a7d9:function(t,a,e){"use strict";var i=e("2d85"),s=e.n(i);s.a},cb2d:function(t,a,e){"use strict";var i=e("75ac"),s=e.n(i);s.a}}]);
//# sourceMappingURL=chunk-2a1ce23e.fe2bfb50.js.map